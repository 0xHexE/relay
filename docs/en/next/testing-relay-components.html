<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Testing Relay Components · Relay</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="The purpose of this document is to cover the Relay APIs for testing Relay components."/><meta name="docsearch:version" content="next"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Testing Relay Components · Relay"/><meta property="og:type" content="website"/><meta property="og:url" content="https://relay.dev/"/><meta property="og:description" content="The purpose of this document is to cover the Relay APIs for testing Relay components."/><meta property="og:image" content="https://relay.dev/img/relay.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://relay.dev/img/relay.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-44373548-50', 'auto');
              ga('send', 'pageview');
            </script><script type="text/javascript" src="/js/redirect.js"></script><script type="text/javascript" src="/js/docsRating.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/en"><h2 class="headerTitle">Relay</h2></a><a href="/en/versions"><h3>next</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/en/next/introduction-to-relay" target="_self">Docs</a></li><li class=""><a href="/en/help" target="_self">Help</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li><li class=""><a href="https://github.com/facebook/relay" target="_self">GitHub</a></li><li class=""><a target="_self"></a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Guides</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Introduction<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/next/introduction-to-relay">Introduction to Relay</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/prerequisites">Prerequisites</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/installation-and-setup">Installation and Setup</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/quick-start-guide">Quick Start Guide</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">API Reference<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/next/graphql-in-relay">GraphQL in Relay</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/relay-environment">Relay Environment</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/network-layer">Network Layer</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/query-renderer">QueryRenderer</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/fragment-container">Fragment Container</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/refetch-container">Refetch Container</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/pagination-container">Pagination Container</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/mutations">Mutations</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/subscriptions">Subscriptions</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/relay-store">Relay Store</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/fetch-query">fetchQuery</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Guides<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/next/routing">Routing</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/relay-debugging">Debugging</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/graphql-server-specification">GraphQL Server Specification</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/persisted-queries">Persisted Queries</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/type-emission">Type Emission</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/en/next/testing-relay-components">Testing Relay Components</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/local-state-management">Local State Management</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Principles &amp; Architecture<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/next/thinking-in-graphql">Thinking in GraphQL</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/thinking-in-relay">Thinking In Relay</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/architecture-overview">Architecture Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/compiler-architecture">Compiler Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/runtime-architecture">Runtime Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/videos">Videos</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Community<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/next/community-learning-resources">Community Learning Resources</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/facebook/relay/edit/master/docs/Modern-TestingRelayComponents.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 id="__docusaurus" class="postHeaderTitle">Testing Relay Components</h1></header><article><div><span><p>The purpose of this document is to cover the Relay APIs for testing Relay components.</p>
<p>The content is focused mostly on Jest unit-tests (testing individual components) and integration tests (testing a combination of components), but these testing tools may be applied in different cases: screenshot-tests, production smoke-tests, fuzz-tests, e2e test, etc.</p>
<p>The benefits of writing Jest tests:</p>
<ul>
<li>In general, it improves the stability of the system. Flow really helps with catching a various set of JavaScript errors, but it is still possible to introduce regressions to the components. Unit-tests may help to find, reproduce, and fix those regressions, and prevent them in the future.</li>
<li>It simplifies the refactoring process: when properly written (testing public interface, not implementation), tests really help with changing the internal implementation of the components.</li>
<li>It may speed up and improve the development workflow. Some people may call it Test Driven Development (TM). But essentially it's just writing tests for public interfaces of your components, and then writing the components that are implementing those interfaces. Jest --watch mode is really shining in this case.</li>
<li>It will simplify the onboarding process for new developers, having tests really help to ramp up on the new code base, fixing bugs, and delivering features.</li>
</ul>
<p>One thing to note: while Jest unit and integration tests will help improve the stability of the system, they should be considered as a part of a bigger stability infrastructure with multiple layers of automated testing: flow, e2e, screenshot and performance tests.</p>
<h2><a class="anchor" aria-hidden="true" id="testing-with-relay"></a><a href="#testing-with-relay" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Testing with Relay</h2>
<p>Testing applications that are using Relay may be challenging, because of the additional data fetching layer that is wrapping the actual product code.</p>
<p>It's not always easy to understand the mechanics of all processes that are happening behind Relay, and how to properly handle interactions with the framework.</p>
<p>Fortunately, we have tools that aim to simplify the process of writing tests for Relay components, by providing imperative APIs for controlling the request/response flow and additional API for mock data generation.</p>
<p>There are two main modules that you may use in your tests:</p>
<ul>
<li><code>createMockEnvironment(options): RelayMockEnvironment</code></li>
<li><code>MockPayloadGenerator</code> and <code>@relay_test_operation</code> directive</li>
</ul>
<p>With <code>createMockEnvironment</code>, you are able to create an instance of <code>RelayMockEnvironment</code>, a Relay environment specifically for your tests. The instance created by <code>createMockEnvironment</code> is implementing the Relay Environment Interface and it also has an additional Mock layer, with methods that allow to resolve/reject and control the flow of operations (queries/mutations/subscriptions).</p>
<p>The main purpose of <code>MockPayloadGenerator</code> is to improve the process of creating and maintaining the mock data for tested components.</p>
<p>One of the patterns you may see in the tests for Relay components: 95% of the test code is the test preparation: the gigantic mock object with dummy data, manually created, or just a copy of a sample server response that needs to be passed as the network response. The remaining 5% is the actual test. As a result, people don't test much. It's hard to create and manage all these dummy payloads for different cases. Hence, writing tests is time-consuming and painful to maintain.</p>
<p>With the <code>MockPayloadGenerator</code> and <code>@relay_test_operation</code>, we want to get rid of this pattern and switch the developer's focus from the preparation of the test to the actual testing.</p>
<h2><a class="anchor" aria-hidden="true" id="relaymockenvironment-api-overview"></a><a href="#relaymockenvironment-api-overview" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>RelayMockEnvironment</code> API Overview</h2>
<p><code>RelayMockEnvironment</code> is a special version of Relay Environment with an additional API methods for controlling the operation flow: resolving and rejection operations, providing incremental payloads for subscriptions, working with cache.</p>
<ul>
<li>Methods for finding operations executed on the environment
<ul>
<li><code>getAllOperations()</code> - get all operation executed during the test by the current time</li>
<li><code>findOperation(findFn =&gt; boolean)</code>- find particular operation in the list of all executed operations, this method will throw, if operation is not available. Maybe useful to find a particular operation when multiple operations executed at the same time</li>
<li><code>getMostRecentOperation() -</code> return the most recent operation, this method will throw if no operations were executed prior this call.</li>
</ul></li>
<li>Methods for resolving or rejecting operations
<ul>
<li><code>nextValue(request | operation, data)</code> - provide payload for operation(request), but not complete request. Practically useful when testing incremental updates and subscriptions</li>
<li><code>complete(request | operation)</code>  - complete the operation, no more payloads are expected for this operation, when it's completed.</li>
<li><code>resolve(request | operation, data)</code> - resolve the request with provided GraphQL response. Essentially, it's nextValue(...) and complete(...)</li>
<li><code>reject(request | operation, error)</code> - reject the request with particular error</li>
<li><code>resolveMostRecentOperation(data | operation =&gt; data)</code> - resolve and getMostRecentOperation work together</li>
<li><code>rejectMostRecentOperation(error | operation =&gt; error)</code>  - reject and getMostRecentOperation work together</li>
<li><code>queueOperationResolver(operation =&gt; data | error)</code> - adds an OperationResolver function to the queue, those methods will be used to resolve/reject operations as they appear</li>
</ul></li>
<li>Additional utility methods
<ul>
<li><code>isLoading(request | operation)</code> - will return <code>true</code> if operations have not been completed, yet.</li>
<li><code>cachePayload(request | operation, variables, payload)</code> - will add payload to QueryResponse cache</li>
<li><code>clearCache()</code>- will clear <code>QueryResponse</code> cache</li>
</ul></li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="mock-payload-generator-and-relay_test_operation-directive"></a><a href="#mock-payload-generator-and-relay_test_operation-directive" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mock Payload Generator and <code>@relay_test_operation</code> Directive</h2>
<p><code>MockPayloadGenerator</code> may drastically simplify the process of creating and maintaining mock data for your tests. <code>MockPayloadGenerator</code> is the module that can generate dummy data for the selection that you have in your operation. There is an API to modify the generated data - Mock Resolvers. With Mock Resolvers, you may adjust the data for your needs. Collection of Mock Resolvers it's an object where keys are names of GraphQL types (ID, String, User, Feedback, Comment, etc), and values are functions that will return the default data for the type.</p>
<p>Example of a simple Mock Resolver:</p>
<pre><code class="hljs css language-javascript">{
  <span class="hljs-function"><span class="hljs-title">ID</span>(<span class="hljs-params"></span>)</span> {
    <span class="hljs-comment">// Return mock value for a scalar filed with type ID</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;my-id&#x27;</span>;
  },
  <span class="hljs-function"><span class="hljs-title">String</span>(<span class="hljs-params"></span>)</span> {
    <span class="hljs-comment">// Every scalar field with type String will have this default value</span>
    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Lorem Ipsum&quot;</span>
  }
}
</code></pre>
<p>It is possible to define more resolvers for Object types:</p>
<pre><code class="hljs css language-javascript">{
  <span class="hljs-comment">// This will be the default values for User object in the query response</span>
  <span class="hljs-function"><span class="hljs-title">User</span>(<span class="hljs-params"></span>)</span> {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">id</span>: <span class="hljs-number">1000</span>,
      <span class="hljs-attr">name</span>: <span class="hljs-string">&quot;Alice&quot;</span>,
      <span class="hljs-attr">profile_picture</span>: {
        <span class="hljs-attr">uri</span>: <span class="hljs-string">&quot;http://my-image...&quot;</span>,
      },
    };
  },
}
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="mock-resolver-context"></a><a href="#mock-resolver-context" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mock Resolver Context</h3>
<p>The first argument of the MockResolver is the object that contains Mock Resolver Context. It is possible to return dynamic values from mock resolvers based on the context - for instance, name or alias of the field, a path in the selection, arguments, or parent type.</p>
<pre><code class="hljs css language-javascript">{
  <span class="hljs-function"><span class="hljs-title">String</span>(<span class="hljs-params">context</span>)</span> {
    <span class="hljs-keyword">if</span> (context.name === <span class="hljs-string">&#x27;zip&#x27;</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;94025&#x27;</span>;
    }
    <span class="hljs-keyword">if</span> (context.path != <span class="hljs-literal">null</span> &amp;&amp; context.path.join(<span class="hljs-string">&#x27;.&#x27;</span>) === <span class="hljs-string">&#x27;node.actor.name&#x27;</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Current Actor Name&#x27;</span>;
    }
    <span class="hljs-keyword">if</span> (context.parentType === <span class="hljs-string">&#x27;Image&#x27;</span> &amp;&amp; context.name === <span class="hljs-string">&#x27;uri&#x27;</span>) {
       <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;http://my-image.url&#x27;</span>;
    }
  }
}
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="id-generation"></a><a href="#id-generation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>ID Generation</h3>
<p>The second argument of the Mock Resolver its a function that will generate a sequence of integers, useful to generate unique IDs in the tests:</p>
<pre><code class="hljs css language-javascript">{
  <span class="hljs-comment">// will generate strings &quot;my-id-1&quot;, &quot;my-id-2&quot;, etc.</span>
  <span class="hljs-function"><span class="hljs-title">ID</span>(<span class="hljs-params">_, generateId</span>)</span> {
     <span class="hljs-keyword">return</span> <span class="hljs-string">`my-id-<span class="hljs-subst">${generateId()}</span>`</span>;
  },
}
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="relay_test_operation"></a><a href="#relay_test_operation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><code>@relay_test_operation</code></h3>
<p>Most of GraphQL type information for a specific field in the selection is not available during Relay runtime. By default, Relay, cannot get type information for a scalar field in the selection, or an interface type of the object.</p>
<p>Operations with the <code>@relay_test_operation</code> directive will have additional metadata that will contain GraphQL type info for fields in the operation's selection. And it will improve the quality of the generated data. You also will be able to define Mock resolvers for Scalar (not only ID and String) and Abstract types:</p>
<pre><code class="hljs css language-javascript">{
  <span class="hljs-function"><span class="hljs-title">Float</span>(<span class="hljs-params"></span>)</span> {
    <span class="hljs-keyword">return</span> <span class="hljs-number">123.456</span>;
  },
  <span class="hljs-function"><span class="hljs-title">Boolean</span>(<span class="hljs-params">context</span>)</span> {
    <span class="hljs-keyword">if</span> (contex.name === <span class="hljs-string">&#x27;can_edit&#x27;</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  },
  <span class="hljs-function"><span class="hljs-title">Node</span>(<span class="hljs-params"></span>)</span> {
    <span class="hljs-keyword">return</span> {
      <span class="hljs-attr">__typename</span>: <span class="hljs-string">&#x27;User&#x27;</span>,
      <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;my-user-id&#x27;</span>,
    };
  }
}
</code></pre>
<h2><a class="anchor" aria-hidden="true" id="examples"></a><a href="#examples" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Examples</h2>
<h3><a class="anchor" aria-hidden="true" id="relay-component-test"></a><a href="#relay-component-test" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Relay Component Test</h3>
<p>Using <code>createMockEnvironment</code> and <code>MockPayloadGenerator</code> allows writing concise tests for components that are using Relay Containers and Renderers. Both those modules can be imported from <code>relay-test-utils</code>.</p>
<pre><code class="hljs css language-javascript"><span class="hljs-comment">// Say you have a component with the QueryRenderer</span>
<span class="hljs-keyword">const</span> MyAwesomeViewRoot = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;MyAwesomeViewRoot&#x27;</span>);
<span class="hljs-keyword">const</span> {
  createMockEnvironment,
  MockPayloadGenerator,
} = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;relay-test-utils&#x27;</span>);

<span class="hljs-comment">// Relay may trigger 3 different states</span>
<span class="hljs-comment">// for this component: Loading, Error, Data Loaded</span>
<span class="hljs-comment">// Here is examples of tests for those states.</span>
test(<span class="hljs-string">&#x27;Loading State&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> environment = createMockEnvironment();
  <span class="hljs-keyword">const</span> renderer = ReactTestRenderer.create(
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">MyAwesomeViewRoot</span> <span class="hljs-attr">environment</span>=<span class="hljs-string">{environment}</span> /&gt;</span></span>,
  );

  <span class="hljs-comment">// Here we just verify that the spinner is rendered</span>
  expect(
    renderer.root.find(<span class="hljs-function"><span class="hljs-params">node</span> =&gt;</span> node.props[<span class="hljs-string">&#x27;data-testid&#x27;</span>] === <span class="hljs-string">&#x27;spinner&#x27;</span>),
  ).toBeDefined();
});

test(<span class="hljs-string">&#x27;Data Render&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> environment = createMockEnvironment();
  <span class="hljs-keyword">const</span> renderer = ReactTestRenderer.create(
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">MyAwesomeViewRoot</span> <span class="hljs-attr">environment</span>=<span class="hljs-string">{environment}</span> /&gt;</span></span>,
  );

  environment.mock.resolveMostRecentOperation(<span class="hljs-function"><span class="hljs-params">operation</span> =&gt;</span>
    MockPayloadGenerator.generate(operation),
  );

  <span class="hljs-comment">// At this point operation will be resolved</span>
  <span class="hljs-comment">// and the data for a query will be available in the store</span>
  expect(
    renderer.root.find(<span class="hljs-function"><span class="hljs-params">node</span> =&gt;</span> node.props[<span class="hljs-string">&#x27;data-testid&#x27;</span>] === <span class="hljs-string">&#x27;myButton&#x27;</span>),
  ).toBeDefined();
});

test(<span class="hljs-string">&#x27;Error State&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> environment = createMockEnvironment();
  <span class="hljs-keyword">const</span> renderer = ReactTestRenderer.create(
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">MyAwesomeViewRoot</span> <span class="hljs-attr">environment</span>=<span class="hljs-string">{environment}</span> /&gt;</span></span>,
  );

  <span class="hljs-comment">// Error can be simulated with `rejectMostRecentOperation`</span>
  environment.mock.rejectMostRecentOperation(<span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&#x27;Uh-oh&#x27;</span>));

  expect(
    renderer.root.find(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> (item.props.testID = <span class="hljs-string">&#x27;errorMessage&#x27;</span>)),
  ).toBeDefined();
});
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="fragment-container-tests"></a><a href="#fragment-container-tests" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Fragment Container Tests</h3>
<p>Essentially, in the example above, <code>resolveMostRecentOperation</code> will generate data for all child fragment containers (pagination, refetch). Usually, the Root Components container may have many child fragment components and you may want to exercise a specific Fragment Container. The solution for that would be to wrap your fragment container with the QueryRenderer that renders a Query that's spreads fragments from your fragment container.</p>
<pre><code class="hljs css language-javascript">test(<span class="hljs-string">&#x27;Fragment Container&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> environment = createMockEnvironment();
  <span class="hljs-keyword">const</span> TestRenderer = <span class="hljs-function">() =&gt;</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">QueryRenderer</span>
      <span class="hljs-attr">environment</span>=<span class="hljs-string">{environment}</span>
      <span class="hljs-attr">query</span>=<span class="hljs-string">{graphql</span>`
        <span class="hljs-attr">query</span> <span class="hljs-attr">TestQuery</span> @<span class="hljs-attr">relay_test_operation</span> {
          <span class="hljs-attr">myData:</span> <span class="hljs-attr">node</span>(<span class="hljs-attr">id:</span> &quot;<span class="hljs-attr">test-id</span>&quot;) {
            <span class="hljs-attr">...MyFragment</span>
          }
        }
      `}
      <span class="hljs-attr">variables</span>=<span class="hljs-string">{{}}</span>
      <span class="hljs-attr">render</span>=<span class="hljs-string">{({error,</span> <span class="hljs-attr">props</span>}) =&gt;</span> {
        if (props) {
          return <span class="hljs-tag">&lt;<span class="hljs-name">MyFragmentContainer</span> <span class="hljs-attr">myData</span>=<span class="hljs-string">{props.myData}</span> /&gt;</span>;
        } else if (error) {
          return error.message;
        }
        return &#x27;Loading...&#x27;;
      }}
    /&gt;</span>
  );
  <span class="hljs-keyword">const</span> renderer = ReactTestRenderer.create(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">TestRenderer</span> /&gt;</span></span>);
  environment.mock.resolveMostRecentOperation(<span class="hljs-function"><span class="hljs-params">operation</span> =&gt;</span>
    MockPayloadGenerator.generate(operation),
  );

  expect(renderer).toMatchSnapshot();
});
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="pagination-container-test"></a><a href="#pagination-container-test" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Pagination Container Test</h3>
<p>Essentially, tests for Pagination container are not different from Fragment Container tests. We can also do more here. We can actually see how the pagination works by asserting the behavior of our components when performing pagination (load more, refetch).</p>
<pre><code class="hljs css language-javascript"><span class="hljs-comment">// Pagination Example</span>
test(<span class="hljs-string">&#x27;Pagination Container&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> environment = createMockEnvironment();
  <span class="hljs-keyword">const</span> TestRenderer = <span class="hljs-function">() =&gt;</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">QueryRenderer</span>
      <span class="hljs-attr">environment</span>=<span class="hljs-string">{environment}</span>
      <span class="hljs-attr">query</span>=<span class="hljs-string">{graphql</span>`
        <span class="hljs-attr">query</span> <span class="hljs-attr">TestQuery</span> @<span class="hljs-attr">relay_test_operation</span> {
          <span class="hljs-attr">myConnection:</span> <span class="hljs-attr">node</span>(<span class="hljs-attr">id:</span> &quot;<span class="hljs-attr">test-id</span>&quot;) {
            <span class="hljs-attr">connection</span> {
              <span class="hljs-attr">...MyConnectionFragment</span>
            }
          }
        }
      `}
      <span class="hljs-attr">variables</span>=<span class="hljs-string">{{}}</span>
      <span class="hljs-attr">render</span>=<span class="hljs-string">{({error,</span> <span class="hljs-attr">props</span>}) =&gt;</span> {
        if (props) {
          return <span class="hljs-tag">&lt;<span class="hljs-name">MyPaginationContainer</span> <span class="hljs-attr">connection</span>=<span class="hljs-string">{props.myConnection.connection}</span> /&gt;</span>;
        } else if (error) {
          return error.message;
        }
        return &#x27;Loading...&#x27;;
      }}
    /&gt;</span>
  );
  <span class="hljs-keyword">const</span> renderer = ReactTestRenderer.create(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">TestRenderer</span> /&gt;</span></span>);
  environment.mock.resolveMostRecentOperation(<span class="hljs-function"><span class="hljs-params">operation</span> =&gt;</span>
    MockPayloadGenerator.generate(operation, {
      <span class="hljs-function"><span class="hljs-title">ID</span>(<span class="hljs-params">_, generateId</span>)</span> {
        <span class="hljs-comment">// Why we&#x27;re doing this?</span>
        <span class="hljs-comment">// To make sure that we will generate a different set of ID</span>
        <span class="hljs-comment">// for elements on first page and the second page.</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">`first-page-id-<span class="hljs-subst">${generateId()}</span>`</span>;
      },
      <span class="hljs-function"><span class="hljs-title">PageInfo</span>(<span class="hljs-params"></span>)</span> {
        <span class="hljs-keyword">return</span> {
          <span class="hljs-attr">has_next_page</span>: <span class="hljs-literal">true</span>,
        };
      },
    }),
  );

  <span class="hljs-comment">// Let&#x27;s find a `loadMore` button and click on it to initiate pagination request, for example</span>
  <span class="hljs-keyword">const</span> loadMore = renderer.root.find(<span class="hljs-function"><span class="hljs-params">node</span> =&gt;</span> node.props[<span class="hljs-string">&#x27;data-testid&#x27;</span>] === <span class="hljs-string">&#x27;loadMore&#x27;</span>)
  expect(loadMore.props.disabled).toBe(<span class="hljs-literal">false</span>);
  loadMore.props.onClick();

  environment.mock.resolveMostRecentOperation(<span class="hljs-function"><span class="hljs-params">operation</span> =&gt;</span>
    MockPayloadGenerator.generate(operation, {
      <span class="hljs-function"><span class="hljs-title">ID</span>(<span class="hljs-params">_, generateId</span>)</span> {
        <span class="hljs-comment">// See, the second page IDs will be different</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">`second-page-id-<span class="hljs-subst">${generateId()}</span>`</span>;
      },
      <span class="hljs-function"><span class="hljs-title">PageInfo</span>(<span class="hljs-params"></span>)</span> {
        <span class="hljs-keyword">return</span> {
          <span class="hljs-comment">// And the button should be disabled, now. Probably.</span>
          <span class="hljs-attr">has_next_page</span>: <span class="hljs-literal">false</span>,
        };
      },
    }),
  );
  expect(loadMore.props.disabled).toBe(<span class="hljs-literal">true</span>);
});

</code></pre>
<h3><a class="anchor" aria-hidden="true" id="refetch-container"></a><a href="#refetch-container" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Refetch Container</h3>
<p>We can use similar approach here with wrapping container with Query Renderer. And for the sake of completeness, we will add example here:</p>
<pre><code class="hljs css language-javascript">test(<span class="hljs-string">&#x27;Refetch Container&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> environment = createMockEnvironment();
  <span class="hljs-keyword">const</span> TestRenderer = <span class="hljs-function">() =&gt;</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">QueryRenderer</span>
      <span class="hljs-attr">environment</span>=<span class="hljs-string">{environment}</span>
      <span class="hljs-attr">query</span>=<span class="hljs-string">{graphql</span>`
        <span class="hljs-attr">query</span> <span class="hljs-attr">TestQuery</span> @<span class="hljs-attr">relay_test_operation</span> {
          <span class="hljs-attr">myData:</span> <span class="hljs-attr">node</span>(<span class="hljs-attr">id:</span> &quot;<span class="hljs-attr">test-id</span>&quot;) {
            <span class="hljs-attr">...MyRefetchableFragment</span>
          }
        }
      `}
      <span class="hljs-attr">variables</span>=<span class="hljs-string">{{}}</span>
      <span class="hljs-attr">render</span>=<span class="hljs-string">{({error,</span> <span class="hljs-attr">props</span>}) =&gt;</span> {
        if (props) {
          return <span class="hljs-tag">&lt;<span class="hljs-name">MyRefetchContainer</span> <span class="hljs-attr">myData</span>=<span class="hljs-string">{props.myData}</span> /&gt;</span>;
        } else if (error) {
          return error.message;
        }
        return &#x27;Loading...&#x27;;
      }}
    /&gt;</span>
  );

  <span class="hljs-keyword">const</span> renderer = ReactTestRenderer.create(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">TestRenderer</span> /&gt;</span></span>);
  environment.mock.resolveMostRecentOperation(<span class="hljs-function"><span class="hljs-params">operation</span> =&gt;</span>
    MockPayloadGenerator.generate(operation),
  );
  <span class="hljs-comment">// Assuming we have refetch button in the Container</span>
  <span class="hljs-keyword">const</span> refetchButton = renderer.root.find(<span class="hljs-function"><span class="hljs-params">node</span> =&gt;</span> node.props[<span class="hljs-string">&#x27;data-testid&#x27;</span>] === <span class="hljs-string">&#x27;refetch&#x27;</span>);

  <span class="hljs-comment">// This should trigger the `refetch`</span>
  refetchButton.props.onClick();

  environment.mock.resolveMostRecentOperation(<span class="hljs-function"><span class="hljs-params">operation</span> =&gt;</span>
    MockPayloadGenerator.generate(operation, {
      <span class="hljs-comment">// We can customize mock resolvers, to change the output of the refetch query</span>
    }),
  );
  <span class="hljs-comment">// expect(renderer).toMatchSnapshot();</span>
});
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="mutations"></a><a href="#mutations" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mutations</h3>
<p>Mutations itself are operations so we can test them independently (unit-test) for specific mutation, or in combination with the view from which this mutation is called.</p>
<pre><code class="hljs css language-javascript"><span class="hljs-comment">// Say, you have a mutation function</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sendMutation</span>(<span class="hljs-params">environment, onCompleted, onError, variables</span>)
  <span class="hljs-title">commitMutation</span>(<span class="hljs-params">environment, {
    mutation: graphql<span class="hljs-string">`...`</span>,
    onCompleted,
    onError,
    variables,
  }</span>)</span>;
}

<span class="hljs-comment">// Example test may be written like so</span>
test(<span class="hljs-string">&#x27;it should send mutation&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> environment = createMockEnvironment();
  <span class="hljs-keyword">const</span> onCompleted = jest.fn();
  sendMutation(environment, onCompleted, jest.fn(), {});
  <span class="hljs-keyword">const</span> operation = environment.mock.getMostRecentOperation();
  environment.mock.resolve(
    operation,
    MockPayloadGenerator.generate(operation)
  );
  expect(onCompleted).toBeCalled();
});
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="subscription"></a><a href="#subscription" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Subscription</h3>
<p>We can test subscription in a similar way we test mutations</p>
<pre><code class="hljs css language-javascript"><span class="hljs-comment">// Example subscribe function</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">subscribe</span>(<span class="hljs-params">environment, onNext, onError, variables</span>)
  <span class="hljs-title">requestSubscription</span>(<span class="hljs-params">environment, {
    subscription: graphql<span class="hljs-string">`...`</span>,
    onNext,
    onError,
    variables,
  }</span>)</span>;
}

<span class="hljs-comment">// Example test may be written like so</span>
test(<span class="hljs-string">&#x27;it should subscribe&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> environment = createMockEnvironment();
  <span class="hljs-keyword">const</span> onNext = jest.fn();
  subscribe(environment, onNext, jest.fn(), {});
  <span class="hljs-keyword">const</span> operation = environment.mock.getMostRecentOperation();
  environment.mock.nextValue(
    operation,
    MockPayloadGenerator.generate(operation)
  );
  expect(onNext).toBeCalled();
});
</code></pre>
<h3><a class="anchor" aria-hidden="true" id="example-with-queueoperationresolver"></a><a href="#example-with-queueoperationresolver" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Example with <code>queueOperationResolver</code></h3>
<p>With <code>queueOpeararionResolver</code>, it possible to define responses for operations that will be executed on the environment</p>
<pre><code class="hljs css language-javascript"><span class="hljs-comment">// Say you have a component with the QueryRenderer</span>
<span class="hljs-keyword">const</span> MyAwesomeViewRoot = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;MyAwesomeViewRoot&#x27;</span>);
<span class="hljs-keyword">const</span> {
  createMockEnvironment,
  MockPayloadGenerator,
} = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;relay-test-utils&#x27;</span>);

test(<span class="hljs-string">&#x27;Data Render&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> environment = createMockEnvironment();
  environment.mock.queueOperationResolver(<span class="hljs-function"><span class="hljs-params">operation</span> =&gt;</span>
    MockPayloadGenerator.generate(operation),
  );

  <span class="hljs-keyword">const</span> renderer = ReactTestRenderer.create(
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">MyAwesomeViewRoot</span> <span class="hljs-attr">environment</span>=<span class="hljs-string">{environment}</span> /&gt;</span></span>,
  );

  <span class="hljs-comment">// At this point operation will be resolved</span>
  <span class="hljs-comment">// and the data for a query will be available in the store</span>
  expect(
    renderer.root.find(<span class="hljs-function"><span class="hljs-params">node</span> =&gt;</span> node.props[<span class="hljs-string">&#x27;data-testid&#x27;</span>] === <span class="hljs-string">&#x27;myButton&#x27;</span>),
  ).toBeDefined();
});

test(<span class="hljs-string">&#x27;Error State&#x27;</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> environment = createMockEnvironment();
  environment.mock.queueOperationResolver(<span class="hljs-function">() =&gt;</span>
    <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&#x27;Uh-oh&#x27;</span>),
  );
  <span class="hljs-keyword">const</span> renderer = ReactTestRenderer.create(
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">MyAwesomeViewRoot</span> <span class="hljs-attr">environment</span>=<span class="hljs-string">{environment}</span> /&gt;</span></span>,
  );

  expect(
    renderer.root.find(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> (item.props.testID = <span class="hljs-string">&#x27;errorMessage&#x27;</span>)),
  ).toBeDefined();
});

</code></pre>
</span></div></article></div><div class="docLastUpdate"><em>Last updated on 12/17/2020 by Reece Dunham</em></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/en/next/type-emission"><span class="arrow-prev">← </span><span>Type Emission</span></a><a class="docs-next button" href="/docs/en/next/local-state-management"><span>Local State Management</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#testing-with-relay">Testing with Relay</a></li><li><a href="#relaymockenvironment-api-overview"><code>RelayMockEnvironment</code> API Overview</a></li><li><a href="#mock-payload-generator-and-relay_test_operation-directive">Mock Payload Generator and <code>@relay_test_operation</code> Directive</a><ul class="toc-headings"><li><a href="#mock-resolver-context">Mock Resolver Context</a></li><li><a href="#id-generation">ID Generation</a></li><li><a href="#relay_test_operation"><code>@relay_test_operation</code></a></li></ul></li><li><a href="#examples">Examples</a><ul class="toc-headings"><li><a href="#relay-component-test">Relay Component Test</a></li><li><a href="#fragment-container-tests">Fragment Container Tests</a></li><li><a href="#pagination-container-test">Pagination Container Test</a></li><li><a href="#refetch-container">Refetch Container</a></li><li><a href="#mutations">Mutations</a></li><li><a href="#subscription">Subscription</a></li><li><a href="#example-with-queueoperationresolver">Example with <code>queueOperationResolver</code></a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><div class="left-column"><div class="docsRating" id="docsRating">Is this page useful?<svg class="i_thumbsup" alt="Like" id="docsRating-like" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 81.13 89.76"><path d="M22.9 6a18.57 18.57 0 002.67 8.4 25.72 25.72 0 008.65 7.66c3.86 2 8.67 7.13 13.51 11 3.86 3.11 8.57 7.11 11.54 8.45s13.59.26 14.64 1.17c1.88 1.63 1.55 9-.11 15.25-1.61 5.86-5.96 10.55-6.48 16.86-.4 4.83-2.7 4.88-10.93 4.88h-1.35c-3.82 0-8.24 2.93-12.92 3.62a68 68 0 01-9.73.5c-3.57 0-7.86-.08-13.25-.08-3.56 0-4.71-1.83-4.71-4.48h8.42a3.51 3.51 0 000-7H12.28a2.89 2.89 0 01-2.88-2.88 1.91 1.91 0 01.77-1.78h16.46a3.51 3.51 0 000-7H12.29c-3.21 0-4.84-1.83-4.84-4a6.41 6.41 0 011.17-3.78h19.06a3.5 3.5 0 100-7H9.75A3.51 3.51 0 016 42.27a3.45 3.45 0 013.75-3.48h13.11c5.61 0 7.71-3 5.71-5.52-4.43-4.74-10.84-12.62-11-18.71-.15-6.51 2.6-7.83 5.36-8.56m0-6a6.18 6.18 0 00-1.53.2c-6.69 1.77-10 6.65-9.82 14.5.08 5.09 2.99 11.18 8.52 18.09H9.74a9.52 9.52 0 00-6.23 16.9 12.52 12.52 0 00-2.07 6.84 9.64 9.64 0 003.65 7.7 7.85 7.85 0 00-1.7 5.13 8.9 8.9 0 005.3 8.13 6 6 0 00-.26 1.76c0 6.37 4.2 10.48 10.71 10.48h13.25a73.75 73.75 0 0010.6-.56 35.89 35.89 0 007.58-2.18 17.83 17.83 0 014.48-1.34h1.35c4.69 0 7.79 0 10.5-1 3.85-1.44 6-4.59 6.41-9.38.2-2.46 1.42-4.85 2.84-7.62a41.3 41.3 0 003.42-8.13 48 48 0 001.59-10.79c.1-5.13-1-8.48-3.35-10.55-2.16-1.87-4.64-1.87-9.6-1.88a46.86 46.86 0 01-6.64-.29c-1.92-.94-5.72-4-8.51-6.3l-1.58-1.28c-1.6-1.3-3.27-2.79-4.87-4.23-3.33-3-6.47-5.79-9.61-7.45a20.2 20.2 0 01-6.43-5.53 12.44 12.44 0 01-1.72-5.36 6 6 0 00-6-5.86z"></path></svg><svg class="i_thumbsdown" alt="Dislike" id="docsRating-dislike" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 81.13 89.76"><path d="M22.9 6a18.57 18.57 0 002.67 8.4 25.72 25.72 0 008.65 7.66c3.86 2 8.67 7.13 13.51 11 3.86 3.11 8.57 7.11 11.54 8.45s13.59.26 14.64 1.17c1.88 1.63 1.55 9-.11 15.25-1.61 5.86-5.96 10.55-6.48 16.86-.4 4.83-2.7 4.88-10.93 4.88h-1.35c-3.82 0-8.24 2.93-12.92 3.62a68 68 0 01-9.73.5c-3.57 0-7.86-.08-13.25-.08-3.56 0-4.71-1.83-4.71-4.48h8.42a3.51 3.51 0 000-7H12.28a2.89 2.89 0 01-2.88-2.88 1.91 1.91 0 01.77-1.78h16.46a3.51 3.51 0 000-7H12.29c-3.21 0-4.84-1.83-4.84-4a6.41 6.41 0 011.17-3.78h19.06a3.5 3.5 0 100-7H9.75A3.51 3.51 0 016 42.27a3.45 3.45 0 013.75-3.48h13.11c5.61 0 7.71-3 5.71-5.52-4.43-4.74-10.84-12.62-11-18.71-.15-6.51 2.6-7.83 5.36-8.56m0-6a6.18 6.18 0 00-1.53.2c-6.69 1.77-10 6.65-9.82 14.5.08 5.09 2.99 11.18 8.52 18.09H9.74a9.52 9.52 0 00-6.23 16.9 12.52 12.52 0 00-2.07 6.84 9.64 9.64 0 003.65 7.7 7.85 7.85 0 00-1.7 5.13 8.9 8.9 0 005.3 8.13 6 6 0 00-.26 1.76c0 6.37 4.2 10.48 10.71 10.48h13.25a73.75 73.75 0 0010.6-.56 35.89 35.89 0 007.58-2.18 17.83 17.83 0 014.48-1.34h1.35c4.69 0 7.79 0 10.5-1 3.85-1.44 6-4.59 6.41-9.38.2-2.46 1.42-4.85 2.84-7.62a41.3 41.3 0 003.42-8.13 48 48 0 001.59-10.79c.1-5.13-1-8.48-3.35-10.55-2.16-1.87-4.64-1.87-9.6-1.88a46.86 46.86 0 01-6.64-.29c-1.92-.94-5.72-4-8.51-6.3l-1.58-1.28c-1.6-1.3-3.27-2.79-4.87-4.23-3.33-3-6.47-5.79-9.61-7.45a20.2 20.2 0 01-6.43-5.53 12.44 12.44 0 01-1.72-5.36 6 6 0 00-6-5.86z"></path></svg></div><div><a href="/" class="nav-home"><img src="/img/relay.svg" alt="Relay" width="66" height="58"/></a><div class="links-column"><h5>Docs</h5><a href="/docs/en/introduction-to-relay.html">Introduction</a></div></div></div><div><h5>Community</h5><a href="/en/users.html">User Showcase</a></div><div><h5>More</h5><a href="https://github.com/facebook/relay">GitHub</a><a href="https://opensource.facebook.com/legal/terms">Terms of Use</a><a href="https://opensource.facebook.com/legal/privacy">Privacy Policy</a><a href="https://opensource.facebook.com/legal/data-policy/">Data Policy</a><a href="https://opensource.facebook.com/legal/cookie-policy/">Cookie Policy</a></div></section><a href="https://code.facebook.com/projects/" target="_blank" class="fbOpenSource"><img src="/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2021 Facebook Inc.</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '3d7d5825d50ea36bca0e6ad06c926f06',
                indexName: 'relay',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["version:next"]}
              });
            </script></body></html>