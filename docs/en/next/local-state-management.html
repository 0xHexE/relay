<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Local State Management · Relay</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="Relay can be used to read and write local data, and act as a single source of truth for _all_ data in your client application."/><meta name="docsearch:version" content="next"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Local State Management · Relay"/><meta property="og:type" content="website"/><meta property="og:url" content="https://relay.dev/"/><meta property="og:description" content="Relay can be used to read and write local data, and act as a single source of truth for _all_ data in your client application."/><meta property="og:image" content="https://relay.dev/img/relay.png"/><meta name="twitter:card" content="summary"/><meta name="twitter:image" content="https://relay.dev/img/relay.png"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-44373548-50', 'auto');
              ga('send', 'pageview');
            </script><script type="text/javascript" src="/js/redirect.js"></script><script type="text/javascript" src="/js/docsRating.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/en"><h2 class="headerTitle">Relay</h2></a><a href="/en/versions"><h3>next</h3></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/en/next/introduction-to-relay" target="_self">Docs</a></li><li class=""><a href="/en/help" target="_self">Help</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li><li class=""><a href="https://github.com/facebook/relay" target="_self">GitHub</a></li><li class=""><a target="_self"></a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Guides</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Introduction<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/next/introduction-to-relay">Introduction to Relay</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/prerequisites">Prerequisites</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/installation-and-setup">Installation and Setup</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/quick-start-guide">Quick Start Guide</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">API Reference<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/next/graphql-in-relay">GraphQL in Relay</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/relay-environment">Relay Environment</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/network-layer">Network Layer</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/query-renderer">QueryRenderer</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/fragment-container">Fragment Container</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/refetch-container">Refetch Container</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/pagination-container">Pagination Container</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/mutations">Mutations</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/subscriptions">Subscriptions</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/relay-store">Relay Store</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/fetch-query">fetchQuery</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Guides<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/next/routing">Routing</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/relay-debugging">Debugging</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/graphql-server-specification">GraphQL Server Specification</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/persisted-queries">Persisted Queries</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/type-emission">Type Emission</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/testing-relay-components">Testing Relay Components</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/en/next/local-state-management">Local State Management</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Principles &amp; Architecture<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/next/thinking-in-graphql">Thinking in GraphQL</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/thinking-in-relay">Thinking In Relay</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/architecture-overview">Architecture Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/compiler-architecture">Compiler Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/runtime-architecture">Runtime Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/en/next/videos">Videos</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle collapsible">Community<span class="arrow"><svg width="24" height="24" viewBox="0 0 24 24"><path fill="#565656" d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"></path><path d="M0 0h24v24H0z" fill="none"></path></svg></span></h3><ul class="hide"><li class="navListItem"><a class="navItem" href="/docs/en/next/community-learning-resources">Community Learning Resources</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><a class="edit-page-link button" href="https://github.com/facebook/relay/edit/master/docs/Modern-LocalStateManagement.md" target="_blank" rel="noreferrer noopener">Edit</a><h1 id="__docusaurus" class="postHeaderTitle">Local State Management</h1></header><article><div><span><p>Relay can be used to read and write local data, and act as a single source of truth for <em>all</em> data in your client application.
The Relay Compiler fully supports client-side extensions of the schema, which allows you to define local fields and types.</p>
<p>Table of Contents:</p>
<ul>
<li><a href="#extending-the-server-schema">Extending the server schema</a></li>
<li><a href="#querying-local-state">Querying local state</a></li>
<li><a href="#mutating-local-state">Mutating local state</a></li>
<li><a href="#initial-local-state">Initial local state</a></li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="extending-the-server-schema"></a><a href="#extending-the-server-schema" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Extending the server schema</h2>
<p>To extend the server schema, create a new <code>.graphql</code> file inside your <code>--src</code> directory.<br>
Let's call it <code>./src/clientSchema.graphql</code>.</p>
<p>This schema describes what local data can be queried on the client.<br>
It can even be used to extend an existing server schema.</p>
<p>For example, we can create a new type called <code>Note</code>:</p>
<pre><code class="hljs css language-graphql">
<span class="hljs-keyword">type</span> <span class="hljs-type">Note</span> {
  id: <span class="hljs-type">ID</span>!
  title: <span class="hljs-type">String</span>
  body: <span class="hljs-type">String</span>
}

</code></pre>
<p>And then extend the server schema type <code>User</code>, with a list of <code>Note</code>, called <code>notes</code>.</p>
<pre><code class="hljs css language-graphql">
extend <span class="hljs-keyword">type</span> <span class="hljs-keyword">User</span> <span class="hljs-title">{
  notes</span>: [Note]
}

</code></pre>
<h2><a class="anchor" aria-hidden="true" id="querying-local-state"></a><a href="#querying-local-state" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Querying local state</h2>
<p>Accessing local data is no different from querying your GraphQL server, although you are required to include atleast one server field in the query.
The field can be from the server schema, or it can be schema agnostic, like an introspection field (i.e. <code>__typename</code>).</p>
<p>Here, we use a <a href="./query-renderer">QueryRenderer</a> to get the current <code>User</code> via the <code>viewer</code> field, along with their id, name and the local list of notes.</p>
<pre><code class="hljs css language-javascript">
<span class="hljs-comment">// Example.js</span>
<span class="hljs-keyword">import</span> React <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;
<span class="hljs-keyword">import</span> { QueryRenderer, graphql } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-relay&#x27;</span>;

<span class="hljs-keyword">const</span> renderQuery = <span class="hljs-function">(<span class="hljs-params">{error, props}</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (error) {
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>{error.message}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (props) {
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
        {props.viewer.notes.map(({id, title, body}) =&gt; (
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{id}</span>&gt;</span>
            {title}
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
          <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">key</span>=<span class="hljs-string">{id}</span>&gt;</span>
            {body}
          <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
        ))}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    );
  }
  <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Loading<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
}

<span class="hljs-keyword">const</span> Example = <span class="hljs-function">(<span class="hljs-params">props</span>) =&gt;</span> {
  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">QueryRenderer</span>
      <span class="hljs-attr">render</span>=<span class="hljs-string">{renderQuery}</span>
      <span class="hljs-attr">environment</span>=<span class="hljs-string">{environment}</span>
      <span class="hljs-attr">query</span>=<span class="hljs-string">{graphql</span>`
        <span class="hljs-attr">query</span> <span class="hljs-attr">ExampleQuery</span> {
          <span class="hljs-attr">viewer</span> {
            <span class="hljs-attr">id</span>
            <span class="hljs-attr">name</span>
            <span class="hljs-attr">notes</span> {
              <span class="hljs-attr">id</span>
              <span class="hljs-attr">title</span>
              <span class="hljs-attr">body</span>
            }
          }
        }
      `}
    /&gt;</span></span>
  );
}

</code></pre>
<h2><a class="anchor" aria-hidden="true" id="mutating-local-state"></a><a href="#mutating-local-state" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Mutating local state</h2>
<p>All local data lives in the <a href="./relay-store">Relay Store</a>.<br>
Updating local state can be done with any <code>updater</code> function.
The <code>commitLocalUpdate</code> function is especially ideal for this, because writes to local state are usually executed outside of a mutation.</p>
<p>To build upon the previous example, let's try creating, updating and deleting a <code>Note</code> from the list of <code>notes</code> on <code>User</code>.</p>
<h3><a class="anchor" aria-hidden="true" id="create"></a><a href="#create" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Create</h3>
<pre><code class="hljs css language-javascript">
<span class="hljs-keyword">import</span> {commitLocalUpdate} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-relay&#x27;</span>;

<span class="hljs-keyword">let</span> tempID = <span class="hljs-number">0</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createUserNote</span>(<span class="hljs-params"></span>) </span>{
  commitLocalUpdate(environment, <span class="hljs-function"><span class="hljs-params">store</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> user = store.getRoot().getLinkedRecord(<span class="hljs-string">&#x27;viewer&#x27;</span>);
    <span class="hljs-keyword">const</span> userNoteRecords = user.getLinkedRecords(<span class="hljs-string">&#x27;notes&#x27;</span>) || [];

    <span class="hljs-comment">// Create a unique ID.</span>
    <span class="hljs-keyword">const</span> dataID = <span class="hljs-string">`client:Note:<span class="hljs-subst">${tempID++}</span>`</span>;

    <span class="hljs-comment">//Create a new note record.</span>
    <span class="hljs-keyword">const</span> newNoteRecord = store.create(dataID, <span class="hljs-string">&#x27;Note&#x27;</span>);

    <span class="hljs-comment">// Add the record to the user&#x27;s list of notes.</span>
    user.setLinkedRecords([...userNoteRecords, newNoteRecord], <span class="hljs-string">&#x27;notes&#x27;</span>);
  });
}

</code></pre>
<p>Note that since this record will be rendered by the <code>ExampleQuery</code> in our <code>QueryRenderer</code>, the QueryRenderer will automatically retain this data so it isn't garbage collected.</p>
<p>If no component is rendering the local data and you want to manually retain it, you can do so by calling <code>environment.retain()</code>:</p>
<pre><code class="hljs css language-javascript">
<span class="hljs-keyword">import</span> {createOperationDescriptor, getRequest} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;relay-runtime&#x27;</span>;

<span class="hljs-comment">// Create a query that references that record</span>
<span class="hljs-keyword">const</span> localDataQuery = graphql<span class="hljs-string">`
  query LocalDataQuery {
    viewer {
      notes {
        __typename
      }
    }
  }
`</span>;

<span class="hljs-comment">// Create an operation descriptor for the query</span>
<span class="hljs-keyword">const</span> request = getRequest(localDataQuery);
<span class="hljs-keyword">const</span> operation = createOperationDescriptor(request, {} <span class="hljs-comment">/* variables */</span>);


<span class="hljs-comment">// Tell Relay to retain this operation so any data referenced by it isn&#x27;t garbage collected</span>
<span class="hljs-comment">// In this case, all the notes linked to the `viewer` will be retained</span>
<span class="hljs-keyword">const</span> disposable = environment.retain(operation);


<span class="hljs-comment">// Whenever you don&#x27;t need that data anymore and it&#x27;s okay for Relay to garbage collect it,</span>
<span class="hljs-comment">// you can dispose of the retain</span>
disposable.dispose();

</code></pre>
<h3><a class="anchor" aria-hidden="true" id="update"></a><a href="#update" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Update</h3>
<pre><code class="hljs css language-javascript">
<span class="hljs-keyword">import</span> {commitLocalUpdate} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-relay&#x27;</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateUserNote</span>(<span class="hljs-params">dataID, body, title</span>) </span>{
  commitLocalUpdate(environment, <span class="hljs-function"><span class="hljs-params">store</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> note = store.get(dataID);

    note.setValue(body, <span class="hljs-string">&#x27;body&#x27;</span>);
    note.setValue(title, <span class="hljs-string">&#x27;title&#x27;</span>)
  });
}

</code></pre>
<h3><a class="anchor" aria-hidden="true" id="delete"></a><a href="#delete" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Delete</h3>
<pre><code class="hljs css language-javascript">
<span class="hljs-keyword">import</span> {commitLocalUpdate} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-relay&#x27;</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">deleteUserNote</span>(<span class="hljs-params">dataID</span>) </span>{
  commitLocalUpdate(environment, <span class="hljs-function"><span class="hljs-params">store</span> =&gt;</span> {
    <span class="hljs-keyword">const</span> user = store.getRoot().getLinkedRecord(<span class="hljs-string">&#x27;viewer&#x27;</span>);
    <span class="hljs-keyword">const</span> userNoteRecords = user.getLinkedRecords(<span class="hljs-string">&#x27;notes&#x27;</span>);

    <span class="hljs-comment">// Remove the note from the list of user notes.</span>
    <span class="hljs-keyword">const</span> newUserNoteRecords = userNoteRecords.filter(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x.getDataID() !== dataID);

    <span class="hljs-comment">// Delete the note from the store.</span>
    store.delete(dataID);

    <span class="hljs-comment">// Set the new list of notes.</span>
    user.setLinkedRecords(newUserNoteRecords, <span class="hljs-string">&#x27;notes&#x27;</span>);
  });
}

</code></pre>
<h2><a class="anchor" aria-hidden="true" id="initial-local-state"></a><a href="#initial-local-state" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Initial local state</h2>
<p>All new client-side schema fields default to <code>undefined</code> value. Often however, you will want to set the initial state before querying local data.
You can use an updater function via <code>commitLocalUpdate</code> to prime local state.</p>
<pre><code class="hljs css language-javascript">
<span class="hljs-keyword">import</span> {commitLocalUpdate} <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react-relay&#x27;</span>;

commitLocalUpdate(environment, <span class="hljs-function"><span class="hljs-params">store</span> =&gt;</span> {
  <span class="hljs-keyword">const</span> user = store.getRoot().getLinkedRecord(<span class="hljs-string">&#x27;viewer&#x27;</span>);

  <span class="hljs-comment">// initialize user notes to an empty array.</span>
  user.setLinkedRecords([], <span class="hljs-string">&#x27;notes&#x27;</span>);
});

</code></pre>
</span></div></article></div><div class="docLastUpdate"><em>Last updated on 2/4/2021 by Robert Balicki</em></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/en/next/testing-relay-components"><span class="arrow-prev">← </span><span>Testing Relay Components</span></a><a class="docs-next button" href="/docs/en/next/thinking-in-graphql"><span class="function-name-prevnext">Thinking in GraphQL</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#extending-the-server-schema">Extending the server schema</a></li><li><a href="#querying-local-state">Querying local state</a></li><li><a href="#mutating-local-state">Mutating local state</a><ul class="toc-headings"><li><a href="#create">Create</a></li><li><a href="#update">Update</a></li><li><a href="#delete">Delete</a></li></ul></li><li><a href="#initial-local-state">Initial local state</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><div class="left-column"><div class="docsRating" id="docsRating">Is this page useful?<svg class="i_thumbsup" alt="Like" id="docsRating-like" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 81.13 89.76"><path d="M22.9 6a18.57 18.57 0 002.67 8.4 25.72 25.72 0 008.65 7.66c3.86 2 8.67 7.13 13.51 11 3.86 3.11 8.57 7.11 11.54 8.45s13.59.26 14.64 1.17c1.88 1.63 1.55 9-.11 15.25-1.61 5.86-5.96 10.55-6.48 16.86-.4 4.83-2.7 4.88-10.93 4.88h-1.35c-3.82 0-8.24 2.93-12.92 3.62a68 68 0 01-9.73.5c-3.57 0-7.86-.08-13.25-.08-3.56 0-4.71-1.83-4.71-4.48h8.42a3.51 3.51 0 000-7H12.28a2.89 2.89 0 01-2.88-2.88 1.91 1.91 0 01.77-1.78h16.46a3.51 3.51 0 000-7H12.29c-3.21 0-4.84-1.83-4.84-4a6.41 6.41 0 011.17-3.78h19.06a3.5 3.5 0 100-7H9.75A3.51 3.51 0 016 42.27a3.45 3.45 0 013.75-3.48h13.11c5.61 0 7.71-3 5.71-5.52-4.43-4.74-10.84-12.62-11-18.71-.15-6.51 2.6-7.83 5.36-8.56m0-6a6.18 6.18 0 00-1.53.2c-6.69 1.77-10 6.65-9.82 14.5.08 5.09 2.99 11.18 8.52 18.09H9.74a9.52 9.52 0 00-6.23 16.9 12.52 12.52 0 00-2.07 6.84 9.64 9.64 0 003.65 7.7 7.85 7.85 0 00-1.7 5.13 8.9 8.9 0 005.3 8.13 6 6 0 00-.26 1.76c0 6.37 4.2 10.48 10.71 10.48h13.25a73.75 73.75 0 0010.6-.56 35.89 35.89 0 007.58-2.18 17.83 17.83 0 014.48-1.34h1.35c4.69 0 7.79 0 10.5-1 3.85-1.44 6-4.59 6.41-9.38.2-2.46 1.42-4.85 2.84-7.62a41.3 41.3 0 003.42-8.13 48 48 0 001.59-10.79c.1-5.13-1-8.48-3.35-10.55-2.16-1.87-4.64-1.87-9.6-1.88a46.86 46.86 0 01-6.64-.29c-1.92-.94-5.72-4-8.51-6.3l-1.58-1.28c-1.6-1.3-3.27-2.79-4.87-4.23-3.33-3-6.47-5.79-9.61-7.45a20.2 20.2 0 01-6.43-5.53 12.44 12.44 0 01-1.72-5.36 6 6 0 00-6-5.86z"></path></svg><svg class="i_thumbsdown" alt="Dislike" id="docsRating-dislike" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 81.13 89.76"><path d="M22.9 6a18.57 18.57 0 002.67 8.4 25.72 25.72 0 008.65 7.66c3.86 2 8.67 7.13 13.51 11 3.86 3.11 8.57 7.11 11.54 8.45s13.59.26 14.64 1.17c1.88 1.63 1.55 9-.11 15.25-1.61 5.86-5.96 10.55-6.48 16.86-.4 4.83-2.7 4.88-10.93 4.88h-1.35c-3.82 0-8.24 2.93-12.92 3.62a68 68 0 01-9.73.5c-3.57 0-7.86-.08-13.25-.08-3.56 0-4.71-1.83-4.71-4.48h8.42a3.51 3.51 0 000-7H12.28a2.89 2.89 0 01-2.88-2.88 1.91 1.91 0 01.77-1.78h16.46a3.51 3.51 0 000-7H12.29c-3.21 0-4.84-1.83-4.84-4a6.41 6.41 0 011.17-3.78h19.06a3.5 3.5 0 100-7H9.75A3.51 3.51 0 016 42.27a3.45 3.45 0 013.75-3.48h13.11c5.61 0 7.71-3 5.71-5.52-4.43-4.74-10.84-12.62-11-18.71-.15-6.51 2.6-7.83 5.36-8.56m0-6a6.18 6.18 0 00-1.53.2c-6.69 1.77-10 6.65-9.82 14.5.08 5.09 2.99 11.18 8.52 18.09H9.74a9.52 9.52 0 00-6.23 16.9 12.52 12.52 0 00-2.07 6.84 9.64 9.64 0 003.65 7.7 7.85 7.85 0 00-1.7 5.13 8.9 8.9 0 005.3 8.13 6 6 0 00-.26 1.76c0 6.37 4.2 10.48 10.71 10.48h13.25a73.75 73.75 0 0010.6-.56 35.89 35.89 0 007.58-2.18 17.83 17.83 0 014.48-1.34h1.35c4.69 0 7.79 0 10.5-1 3.85-1.44 6-4.59 6.41-9.38.2-2.46 1.42-4.85 2.84-7.62a41.3 41.3 0 003.42-8.13 48 48 0 001.59-10.79c.1-5.13-1-8.48-3.35-10.55-2.16-1.87-4.64-1.87-9.6-1.88a46.86 46.86 0 01-6.64-.29c-1.92-.94-5.72-4-8.51-6.3l-1.58-1.28c-1.6-1.3-3.27-2.79-4.87-4.23-3.33-3-6.47-5.79-9.61-7.45a20.2 20.2 0 01-6.43-5.53 12.44 12.44 0 01-1.72-5.36 6 6 0 00-6-5.86z"></path></svg></div><div><a href="/" class="nav-home"><img src="/img/relay.svg" alt="Relay" width="66" height="58"/></a><div class="links-column"><h5>Docs</h5><a href="/docs/en/introduction-to-relay.html">Introduction</a></div></div></div><div><h5>Community</h5><a href="/en/users.html">User Showcase</a></div><div><h5>More</h5><a href="https://github.com/facebook/relay">GitHub</a><a href="https://opensource.facebook.com/legal/terms">Terms of Use</a><a href="https://opensource.facebook.com/legal/privacy">Privacy Policy</a><a href="https://opensource.facebook.com/legal/data-policy/">Data Policy</a><a href="https://opensource.facebook.com/legal/cookie-policy/">Cookie Policy</a></div></section><a href="https://code.facebook.com/projects/" target="_blank" class="fbOpenSource"><img src="/img/oss_logo.png" alt="Facebook Open Source" width="170" height="45"/></a><section class="copyright">Copyright © 2021 Facebook Inc.</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '3d7d5825d50ea36bca0e6ad06c926f06',
                indexName: 'relay',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["version:next"]}
              });
            </script></body></html>